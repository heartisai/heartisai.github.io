<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>js时间日期格式化及EasyUI时间控件的初始化</title>
      <link href="/2014/12/13/js-datetime-format-init/"/>
      <url>/2014/12/13/js-datetime-format-init/</url>
      
        <content type="html"><![CDATA[<h1 id="js时间日期格式化"><a href="#js时间日期格式化" class="headerlink" title="js时间日期格式化"></a>js时间日期格式化</h1><p>javascript没有提供标准可用的时间格式化相关方法，该格式化方法是在网上搜的（原文地址现在没搜着了，下次若看着了再注明原地址），经过修改而成的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//格式化时间</span></span><br><span class="line">$.formatDate = <span class="function"><span class="keyword">function</span>(<span class="params">date,format</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> padNum = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">""</span> + num).replace(<span class="regexp">/^(\d)$/</span>,<span class="string">"0$1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//指定格式字符</span></span><br><span class="line">    <span class="keyword">var</span> cfg = &#123;</span><br><span class="line">        yyyy : date.getFullYear() <span class="comment">//年</span></span><br><span class="line">        ,<span class="attr">yy</span> : date.getFullYear().toString().substring(<span class="number">2</span>)</span><br><span class="line">        ,<span class="attr">M</span>  : date.getMonth() + <span class="number">1</span> <span class="comment">//月</span></span><br><span class="line">        ,<span class="attr">MM</span> : padNum(date.getMonth() + <span class="number">1</span>)</span><br><span class="line">        ,<span class="attr">d</span>  : date.getDate() <span class="comment">//日</span></span><br><span class="line">        ,<span class="attr">dd</span> : padNum(date.getDate())</span><br><span class="line">        ,<span class="attr">H</span>  : date.getHours() <span class="comment">//时: 24小时制</span></span><br><span class="line">        ,<span class="attr">HH</span> : padNum(date.getHours())</span><br><span class="line">        ,<span class="attr">h</span>  : date.getHours()&gt;<span class="number">12</span>?date.getHours()<span class="number">-12</span>:date.getHours() <span class="comment">//时：12小时制</span></span><br><span class="line">        ,<span class="attr">hh</span> : padNum(date.getHours()&gt;<span class="number">12</span>?date.getHours()<span class="number">-12</span>:date.getHours())</span><br><span class="line">        ,<span class="attr">m</span>  : date.getMinutes()</span><br><span class="line">        ,<span class="attr">mm</span> : padNum(date.getMinutes()) <span class="comment">//分</span></span><br><span class="line">        ,<span class="attr">s</span>  : date.getSeconds()</span><br><span class="line">        ,<span class="attr">ss</span> : padNum(date.getSeconds()) <span class="comment">//秒</span></span><br><span class="line">        ,<span class="attr">SSS</span>: (<span class="number">1000</span> + date.getMilliseconds() + <span class="string">""</span>).substring(<span class="number">1</span>) <span class="comment">//毫秒</span></span><br><span class="line">    &#125;</span><br><span class="line">    format || (format = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">    <span class="keyword">return</span> format.replace(<span class="regexp">/([a-z])(\1)*/ig</span>,<span class="function"><span class="keyword">function</span>(<span class="params">m</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cfg[m];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>说明</strong></p><ol><li>该函数的两个参数分别为：1）时间日期 2）格式化字符串</li><li>返回值：按照format格式化的时间日期字符串</li><li>举例说明（以当前时间为2014-12-13 15:30:12为例, <code>var date = new Date();</code> ）：</li></ol><table><thead><tr><th align="left">调用方式</th><th align="left">返回值</th></tr></thead><tbody><tr><td align="left">$.formatDate(date, ‘yyyy-MM-dd HH:mm:ss,SSS’);</td><td align="left">2014-12-13 15:30:12,000</td></tr><tr><td align="left">$.formatDate(date, ‘yyyy-MM-dd HH:mm:ss’);</td><td align="left">2014-12-13 15:30:12</td></tr><tr><td align="left">$.formatDate(date, ‘yyyy-MM-dd HH:mm’);</td><td align="left">2014-12-13 15:30</td></tr><tr><td align="left">$.formatDate(date, ‘HH:mm:ss’);</td><td align="left">15:30:12</td></tr><tr><td align="left">$.formatDate(date, ‘yyyy年MM月dd日’);</td><td align="left">2014年12月13日</td></tr></tbody></table><h1 id="时间日期处理-时间日期的计算"><a href="#时间日期处理-时间日期的计算" class="headerlink" title="时间日期处理(时间日期的计算)"></a>时间日期处理(时间日期的计算)</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定格式日期字符串</span></span><br><span class="line"><span class="comment"> * 参数：可传入三个参数，参数不分先后</span></span><br><span class="line"><span class="comment"> * Date类型参数：表示指定的时间，如果没有则为当前时间</span></span><br><span class="line"><span class="comment"> * String类型参数：格式，如果没有则为yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment"> * Object类型参数：对时间的处理，该参数可以有的属性：</span></span><br><span class="line"><span class="comment"> * d:表示日，M：表示月，m:表示分钟，H:表示小时，y:表示年</span></span><br><span class="line"><span class="comment"> * 示例:$.getDateStr(new Date,'yyyy-MM-dd HH:mm:ss', &#123;d:-3,H:5&#125;);将得5小时后的3天前</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$.getDateStr = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> date, format, options;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="built_in">arguments</span>.length; i++)&#123;</span><br><span class="line">        <span class="keyword">var</span> arg = <span class="built_in">arguments</span>[i];</span><br><span class="line">        <span class="keyword">if</span>(arg === <span class="literal">null</span> || arg === <span class="literal">undefined</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>((<span class="keyword">typeof</span> arg === <span class="string">'string'</span>) &amp;&amp; arg.constructor == <span class="built_in">String</span>)&#123;</span><br><span class="line">            format = arg;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>((<span class="keyword">typeof</span> arg === <span class="string">'object'</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(arg.constructor == <span class="built_in">Date</span>)&#123;</span><br><span class="line">                date = arg;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                options = arg;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    date = date || <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    format = format || <span class="string">"yyyy-MM-dd HH:mm:ss"</span>;</span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cfg = &#123;</span><br><span class="line">        d: <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="comment">//天</span></span><br><span class="line">            date.setDate(date.getDate() + v);</span><br><span class="line">        &#125;,</span><br><span class="line">        M: <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="comment">//月</span></span><br><span class="line">            date.setMonth(date.getMonth() + v);</span><br><span class="line">        &#125;,</span><br><span class="line">        m: <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="comment">//分钟</span></span><br><span class="line">            date.setMinutes(date.getMinutes() + v);</span><br><span class="line">        &#125;,</span><br><span class="line">        H: <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="comment">//小时</span></span><br><span class="line">            date.setHours(date.getHours() + v);</span><br><span class="line">        &#125;,</span><br><span class="line">        y: <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="comment">//年</span></span><br><span class="line">            date.setFullYear(date.getFullYear() + v);</span><br><span class="line">        &#125;,</span><br><span class="line">        s: <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="comment">//秒</span></span><br><span class="line">            date.setSeconds(date.getSeconds() + v);</span><br><span class="line">        &#125;,</span><br><span class="line">        S: <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;<span class="comment">//毫秒</span></span><br><span class="line">            date.setMilliseconds(date.getMilliseconds() + v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> options)&#123;</span><br><span class="line">        cfg[k] &amp;&amp; cfg[k](options[k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $.formatDate(date, format);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>说明</strong></p><table>    <tr>        <th>调用方式</th>        <th>返回值</th>    </tr>    <tr>        <td>$.getDateStr()</td>        <td>2014-12-13 15:30:12</td>    </tr>    <tr>        <td>$.getDateStr({d: 1})</td>        <td>2014-12-14 15:30:12</td>    </tr>    <tr>        <td>$.getDateStr({d: -1})</td>        <td>2014-12-12 15:30:12</td>    </tr>    <tr>        <td>$.getDateStr({d: -13})</td>        <td>2014-11-30 15:30:12</td>    </tr>    <tr>        <td>$.getDateStr({H: -1})</td>        <td>2014-12-13 14:30:12</td>    </tr>    <tr>        <td>$.getDateStr({M:-1, d: 1})</td>        <td>2014-11-14 14:30:12</td>    </tr>    <tr>        <td>$.getDateStr('yyyy-MM-dd')</td>        <td>2014-12-13</td>    </tr>    <tr>        <td>$.getDateStr({M:-1},'yyyy-MM')</td>        <td>2014-11</td>    </tr>    <tr>        <td rowspan="3">            <div>var d = new Date();</div>            <div>d.setDate(25);</div>            <div>$.getDateStr(d,{M:-1},'yyyy-MM-dd 00:00:00');</div>        </td>        <td rowspan="3">2014-11-25 00:00:00</td>    </tr></table><h1 id="EasyUI时间控件datetimebox的初始化"><a href="#EasyUI时间控件datetimebox的初始化" class="headerlink" title="EasyUI时间控件datetimebox的初始化"></a>EasyUI时间控件datetimebox的初始化</h1><p>刚使用EasyUI的时间控件时，遇到一个问题，那就是如何初始化该该控件为系统当前时间或当前时间前一个小时，在网上搜了很久也没有满意答案<br>本文前两点时间格式化和时间日期计算都是为了这个EasyUI时间控件初始化做准备的<br>使用方式如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"startTime"</span> <span class="attr">id</span>=<span class="string">"startTime"</span>  <span class="attr">class</span>=<span class="string">"easyui-datetimebox"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">data-options</span>=<span class="string">"required:true,missingMessage:'开始时间不能为空', editable:false,</span></span></span><br><span class="line"><span class="tag"><span class="string">    value:$.getDateStr(&#123;H:-1&#125;)"</span> <span class="attr">style</span>=<span class="string">"width:183px;"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><strong>说明</strong><br>这里的<code>value:$.getDateStr({H:-1})</code>即是设置初始时间为当前时间的前一个小时</p><p>完</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> easyui </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改EasyUI源码，解决datagrid重复请求数据的问题</title>
      <link href="/2014/12/11/esayui-datagrid-reloaddata/"/>
      <url>/2014/12/11/esayui-datagrid-reloaddata/</url>
      
        <content type="html"><![CDATA[<h1 id="说在前面的话"><a href="#说在前面的话" class="headerlink" title="说在前面的话"></a>说在前面的话</h1><p>前段时间做前后端分离，前端采用jQuery EasyUI。 EasyUI确实是个不错的东东，在使用过程中还是很有收获的，决定写几篇关于EasyUI的文章（当然不会写使用教程之类的东东，因为官方文档已经足够详细了）</p><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>在使用datagrid组件时，发现一个很奇怪的问题，那就是当页面向后台请求数据时，如果未请求到数据，则会再请求一次，很显然这是不合理的、多余的<br>EasyUI的版本：1.4</p><h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><p>原来的代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(_615.total!=data.total)&#123;</span><br><span class="line">_614.pagination(<span class="string">"refresh"</span>,&#123;<span class="attr">total</span>:data.total&#125;);</span><br><span class="line"><span class="keyword">if</span>(opts.pageNumber!=_615.pageNumber)&#123;</span><br><span class="line">opts.pageNumber=_615.pageNumber;</span><br><span class="line">_5d7(_60f);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改后的代码，在<code>_5d7(_60f);</code>外加了一个判断语句</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(_615.total!=data.total)&#123;</span><br><span class="line">_614.pagination(<span class="string">"refresh"</span>,&#123;<span class="attr">total</span>:data.total&#125;);</span><br><span class="line"><span class="keyword">if</span>(opts.pageNumber!=_615.pageNumber)&#123;</span><br><span class="line">opts.pageNumber=_615.pageNumber;</span><br><span class="line"><span class="keyword">if</span>(_615.pageNumber!=<span class="number">0</span>)&#123;</span><br><span class="line">_5d7(_60f);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><ol><li><code>_5d7(_60f);</code> 这一行的作用就是向后台请求数据</li><li><code>_615.pageNumber</code> 则是请求到的数据页数，没数据时，它是0</li><li><code>opts.pageNumber</code> 则是默认时页数，它是1</li><li>很显然，没请求到数据时（即数据条数为0），以上两个值不相等，按原来的代码就会再去请求一次，加上判断后，问题解决</li><li>datagrid加载数据这一块代码，其实是一个间接递归的过程，有意者可自行调试看看（因这并不是真正的源码，而是经过压缩过的，调试起来比较费劲）</li></ol><p>完</p>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> easyui </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
